# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an nginx MPEG-TS Live Module that receives MPEG-TS over HTTP and produces live HLS and MPEG-DASH streams. It's written in C as an nginx module.

## Build Commands

This is an nginx module that must be built with nginx itself:

```bash
# Static module
./configure --add-module=/path/to/nginx-ts-module

# Dynamic module  
./configure --add-dynamic-module=/path/to/nginx-ts-module
```

## Development Commands

- `./sync.sh up` - Sync local changes to remote server (192.168.1.183)
- `./sync.sh down` - Sync remote changes to local directory

## Code Architecture

### Core Components

- **ngx_http_ts_module.c** - Main HTTP module implementation, handles the `ts` directive and request processing
- **ngx_stream_ts_module.c** - Stream module variant for TCP/UDP streams
- **ngx_ts_stream.c/.h** - Core MPEG-TS parsing and stream management, defines packet structures and processing
- **ngx_ts_hls.c/.h** - HLS (HTTP Live Streaming) output generation and playlist management
- **ngx_ts_dash.c/.h** - MPEG-DASH manifest generation and segment management
- **ngx_ts_dash_mp4.c** - MP4 container handling for DASH segments
- **ngx_ts_avc.c/.h** - H.264/AVC video codec handling
- **ngx_ts_aac.c/.h** - AAC audio codec handling

### Module Structure

The module implements nginx directives:
- `ts` - Sets up MPEG-TS handler for a location
- `ts_hls` - Enables HLS output with configurable segment parameters
- `ts_dash` - Enables MPEG-DASH output with configurable segment parameters

### Data Flow

1. MPEG-TS data received via HTTP POST to locations with `ts` directive
2. Parsed by ngx_ts_stream into elementary streams (video/audio)
3. Processed by codec-specific handlers (AVC/AAC)
4. Output generated by HLS and/or DASH modules as segments and manifests

## Configuration

The module uses nginx's configuration system with location-specific settings stored in `ngx_http_ts_loc_conf_t` and per-request context in `ngx_http_ts_ctx_t`.